{% extends 'layout/base.html' %}

{% block content %}
<div class="row mt-5">
    <div class="col-1"></div>
    <div class="col">
        <h1>{{ session.name }}</h1>
        <hr>
    </div>
    <div class="col-1"></div>
</div>

{% if session.hashcat.data.process_state == 1 %}
<div class="row">
    <div class="col-1"></div>
    <div class="col">
        <div class="float-right">
            <label for="autorefresh" class="mr-2">Auto Refresh Page While Running</label>
            <div class="custom-control custom-switch float-right">
                <input type="checkbox" class="custom-control-input" id="autorefresh" value="1" checked>
                <label class="custom-control-label" for="autorefresh"></label>
            </div>
        </div>
    </div>
    <div class="col-1"></div>
</div>
{% endif %}

<div class="row">
    <div class="col-1"></div>
    <div class="col">
        <table class="table">
            <thead>
            <tr class="table-primary">
                <th>State</th>
                <th class="text-right">Progress</th>
                <th class="text-right">Cracked</th>
                <th class="text-right">Estimated Time</th>
                <th class="text-right">Manage</th>
                <th class="text-right">Settings</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                {% set status_class = '' %}
                {% set status_text = 'Unknown' %}
                {% if session.hashcat.data.process_state == 0 %}
                    {% set status_class = 'table-info' %}
                    {% set status_text = 'Not Started' %}
                {% elif session.hashcat.data.process_state == 1 %}
                    {% set status_class = 'table-success' %}
                    {% set status_text = 'Running' %}
                {% elif session.hashcat.data.process_state == 2 %}
                    {% set status_class = 'table-danger' %}
                    {% set status_text = 'Stopped' %}
                {% elif session.hashcat.data.process_state == 3 %}
                    {% set status_class = '' %}
                    {% set status_text = 'Finished' %}
                {% elif session.hashcat.data.process_state == 4 %}
                    {% set status_class = 'table-warning' %}
                    {% set status_text = 'Paused' %}
                {% endif %}
                <th scope="row" class="{{ status_class }}">{{ status_text }}</th>
                <td class="text-right">
                    <a href="#" title="Click to view raw output" class="raw-progress">{{ session.hashcat.data.progress }}%</a>
                </td>
                <td class="text-right">
                    <span>{{ session.hashcat.data.cracked_passwords }}/{{ session.hashcat.data.all_passwords }}</span>
                    {% if session.hashcat.data.cracked_passwords > 0 %}
                    <a href="{{ url_for('sessions.download_cracked', session_id=session.id) }}" class="text-warning ml-1" title="Download"><i class="fas fa-file-download fa-lg"></i></a>
                    {% endif %}
                </td>
                <td class="text-right"><abbr title="{{ session.hashcat.data.estimated_completion_time }}">{{ session.hashcat.data.time_remaining }}</abbr></td>
                <td class="text-right">
                    <form method="post" action="{{ url_for('sessions.action', session_id=session.id) }}" id="form-action">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="action" id="action" value="">

                        {%
                            if session.hashcat.data.process_state == 0 or
                                session.hashcat.data.process_state == 2 or
                                session.hashcat.data.process_state == 3
                        %}
                        <a href="#" data-action="start" title="Start" class="form-action ml-2"><i class="fas fa-lg fa-play text-success"></i></a>
                        <a href="#" data-action="reset" title="Reset - If the session won't start click this link" class="form-action ml-2"><i class="fas fa-lg fa-sync text-danger"></i></a>
                        {% endif %}

                        {% if session.hashcat.data.process_state == 4 %}
                        <a href="#" data-action="resume" title="Resume" class="form-action ml-2"><i class="fas fa-lg fa-play text-success"></i></a>
                        {% endif %}

                        {% if session.hashcat.data.process_state == 1 %}
                        <a href="#" data-action="pause" title="Pause" class="form-action ml-2"><i class="fas fa-lg fa-pause text-warning"></i></a>
                        {% endif %}

                        {% if session.hashcat.data.process_state == 1 or session.hashcat.data.process_state == 4 %}
                        <a href="#" data-action="stop" title="Stop" class="form-action ml-2"><i class="fas fa-lg fa-stop text-danger"></i></a>
                        {% endif %}
                    </form>
                </td>
                <td class="text-right">
                    <a href="{{ url_for('sessions.setup_hashes', session_id=session.id) }}" title="Hashes" class="mr-2"><i class="fas fa-hashtag fa-lg"></i></a>
                    <a href="{{ url_for('sessions.setup_hashcat', session_id=session.id) }}" title="Hashcat Settings"><i class="fas fa-cogs fa-lg"></i></a>
                </td>
            </tr>
            {% if session.hashcat.data.progress|int > 0 and session.hashcat.data.progress|int < 100 %}
            <tr>
                <td class="p-0" colspan="6">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" aria-valuenow="{{ session.hashcat.data.progress|int }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ session.hashcat.data.progress|int }}%"></div>
                    </div>
                </td>
            </tr>
            {% endif %}
            <tr id="raw-progress" class="d-none">
                <td colspan="6">
                    <table class="table table-sm table-striped">
                        <tbody>
                        {% for key, value in session.hashcat.data_raw.items() %}
                        <tr>
                            <th scope="row">{{ key }}</th>
                            <td class="text-right">{{ value }}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="col-1"></div>
</div>

<div class="row">
    <div class="col-1"></div>
    <div class="col">
        <table class="table">
            <thead>
            <tr class="table-primary">
                <th>Cracking Mode</th>
                <th>Hash Type</th>
                <th>Wordlist</th>
                <th>Rule</th>
                <th>Mask</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{{ 'Wordlist' if session.hashcat.mode == 0 else 'Brute Force' }}</td>
                <td><abbr title="{{ supported_hashes[session.hashcat.hashtype] }}">{{ session.hashcat.hashtype }}</abbr></td>
                <td><abbr title="{{ session.hashcat.wordlist_path }}">{{ session.hashcat.wordlist }}</abbr></td>
                <td><abbr title="{{ session.hashcat.rule_path }}">{{ session.hashcat.rule }}</abbr></td>
                <td>N/A</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="col-1"></div>
</div>

<script type="text/javascript" src="{{ url_for('static', filename='js/crackerjack/cj.sessions.view.js') }}"></script>

<script type="text/javascript">
    $(document).ready(function() {
        CJ_SessionsView.init();
    });
</script>
{% endblock %}